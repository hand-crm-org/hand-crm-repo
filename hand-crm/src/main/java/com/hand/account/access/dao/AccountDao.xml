<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hand.account.access.dao.AccountDao">
    <sql id="queryAllAccntInfoSql">
        SELECT
        T1.CODE as code,
        T1.CREATED as created,
        T1.CREATED_BY as createdBy,
        T1.UPDATED as updated,
        T1.UPDATED_BY as updatedBy,
        T1.NAME as name,
        T1.NAME_ENU as nameEnu,
        T1.TAX_CODE as taxCode,
        T1.PAR_ACCNT_CODE as parAccntCode,
        T1.PRI_EMP_CODE as priEmpCode,
        T1.ORG_CODE as orgCode,
        T1.DUNS_CODE as dunsCode,
        T1.CURRENCY as currency,
        T1.PRI_CTCT_CODE as priCtctCode,
        (SELECT NAME FROM HC_CTCT WHERE CODE = T1.PRI_CTCT_CODE AND STATUS = 'Active') as priCtct,
        T1.PH_NUM as phNum,
        T1.FAX_NUM as faxNum,
        T1.EMAIL as email,
        T1.HOME_URL as homeUrl,
        T1.REG_FUND as regFund,
        T1.ADDR_CODE as addrCode
    </sql>
    <sql id="queryALLConditionSql">
        <if test="entity!=null">
            <if test="entity.code!=null and entity.code!=''"> AND T1.CODE=#{entity.code}</if>
            <if test="entity.created!=null"> AND DATE_FORMAT(T1.CREATED,'%Y-%m-%d') = DATE_FORMAT(#{entity.created},'%Y-%m-%d')</if>
            <if test="entity.createdBy!=null and entity.createdBy!=''"> AND T1.CREATED_BY LIKE "%"#{entity.createdBy}"%"</if>
            <if test="entity.updated!=null "> AND DATE_FORMAT(T1.UPDATED,'%Y-%m-%d') = DATE_FORMAT(#{entity.updated},'%Y-%m-%d')</if>
            <if test="entity.updatedBy!=null and entity.updatedBy!=''"> AND T1.UPDATED_BY LIKE "%"#{entity.updatedBy}"%"</if>
            <if test="entity.name!=null and entity.name!=''"> AND T1.NAME LIKE "%"#{entity.name}"%"</if>
            <if test="entity.nameEnu!=null and entity.nameEnu!=''"> AND T1.NAME_ENU LIKE "%"#{entity.nameEnu,jdbcType=VARCHAR}"%"</if>
            <if test="entity.taxCode!=null and entity.taxCode!=''"> AND T1.TAX_CODE LIKE "%"#{entity.taxCode}"%"</if>
            <if test="entity.type!=null and entity.type!=''"> AND T1.TYPE LIKE "%"#{entity.type}"%"</if>
            <if test="entity.parAccntCode!=null and entity.parAccntCode!=''">AND T1.PAR_ACCNT_CODE=#{entity.parAccntCode}</if>
            <if test="entity.priEmpCode!=null and entity.priEmpCode!=''"> AND T1.PRI_EMP_CODE=#{entity.priEmpCode}</if>
            <if test="entity.orgCode!=null and entity.orgCode!=''"> AND T1.ORG_CODE=#{entity.orgCode}</if>
            <if test="entity.dunsCode!=null and entity.dunsCode!=''"> AND T1.DUNS_CODE LIKE "%"#{entity.dunsCode}"%"</if>
            <if test="entity.status!=null and entity.status!=''"> AND T1.STATUS LIKE "%"#{entity.status}"%"</if>
            <if test="entity.periodCode!=null and entity.periodCode!=''"> AND T1.PERIOD_CODE LIKE "%"#{entity.periodCode}"%"</if>
            <if test="entity.priCtctCode!=null and entity.priCtctCode!=''"> AND T1.PRI_CTCT_CODE=#{entity.priCtctCode}</if>
        </if>
    </sql>
    <sql id="updateConditionSql">
        <if test="code!=null">
            <if test="updatedBy!=null and updatedBy!=''">UPDATED_BY=#{updatedBy}</if>
            <if test="name!=null and name!=''">,NAME=#{name}</if>
            <if test="nameEnu!=null and nameEnu!=''">,NAME_ENU=#{nameEnu}</if>
            <if test="taxCode!=null and taxCode!=''">,TAX_CODE=#{taxCode}</if>
            <if test="type!=null and type!=''">,TYPE=#{type}</if>
            <if test="parAccntCode!=null and parAccntCode!=''">,PAR_ACCNT_CODE=#{parAccntCode}</if>
            <if test="priEmpCode!=null and priEmpCode!=''">,PRI_EMP_CODE=#{priEmpCode}</if>
            <if test="orgCode!=null and orgCode!=''">,ORG_CODE=#{orgCode}</if>
            <if test="dunsCode!=null and dunsCode!=''">,DUNS_CODE=#{dunsCode}</if>
            <if test="currency!=null and currency!=''">,CURRENCY=#{currency}</if>
            <if test="phNum!=null and phNum!=''">,PH_NUM=#{phNum}</if>
            <if test="priCtctCode!=null and priCtctCode!=''">,PRI_CTCT_CODE=#{priCtctCode}</if>
            <if test="faxNum!=null and faxNum!=''">,FAX_NUM=#{faxNum}</if>
            <if test="email!=null and email!=''">,EMAIL=#{email}</if>
            <if test="homeUrl!=null and homeUrl!=''">,HOME_URL=#{homeUrl}</if>
            <if test="industry!=null and industry!=''">,INDUSTRY=#{industry}</if>
            <if test="subIndustry!=null and subIndustry!=''">,SUB_INDUSTRY=#{subIndustry}</if>
            <if test="regFund!=null and regFund!=''">,REG_FUND=#{regFund}</if>
            <if test="addrCode!=null and addrCode!=''">,ADDR_CODE=#{addrCode}</if>

        </if>
    </sql>

    <insert id="insertAccount" parameterType="com.hand.account.access.vo.AccountVO">
        INSERT INTO HC_ACCNT(CODE,CREATED,CREATED_BY,NAME,NAME_ENU,TYPE,TAX_CODE,PAR_ACCNT_CODE,PRI_EMP_CODE,ORG_CODE,DUNS_CODE,STATUS,PERIOD_CODE,CURRENCY,PRI_CTCT_CODE,PH_NUM,FAX_NUM,EMAIL,HOME_URL,INDUSTRY,SUB_INDUSTRY,REG_FUND,ADDR_CODE)
        VALUES (#{code},sysdate(),#{updatedBy},#{name},#{nameEnu},#{type},#{taxCode},#{parAccntCode},#{priEmpCode},#{orgCode},#{dunsCode},#{status},#{periodCode},#{currency},#{priCtctCode},#{phNum},#{faxNum},#{email},#{homeUrl},#{industry},#{subIndustry},#{regFund},#{addrCode})
    </insert>

    <select id="queryAccount" parameterType="com.hand.frame.util.PageQuery" resultType="com.hand.account.access.vo.AccountVO">
        <include refid="queryAllAccntInfoSql"></include>,
        ( SELECT VAL FROM HC_LST_OF_VAL WHERE T1.TYPE = `NAME` AND TYPE = 'ACCOUNT_TYPE' AND ACT_FLG = 'Y' AND LANG_ID = #{entity.langId}) AS type,
        ( SELECT VAL FROM HC_LST_OF_VAL WHERE T1.`STATUS` = `NAME` AND TYPE = 'ACCOUNT_STATUS' AND ACT_FLG = 'Y' AND LANG_ID = #{entity.langId} ) AS `status`,
        ( SELECT VAL FROM HC_LST_OF_VAL WHERE T1.PERIOD_CODE = `NAME` AND TYPE = 'ACCOUNT_PERIOD' AND ACT_FLG = 'Y' AND LANG_ID = #{entity.langId} ) AS periodCode,
        ( SELECT VAL FROM HC_LST_OF_VAL WHERE T1.INDUSTRY = `NAME` AND TYPE = 'INDUSTRY_TYPE' AND ACT_FLG = 'Y' AND LANG_ID = #{entity.langId} ) AS industry,
        ( SELECT VAL FROM HC_LST_OF_VAL WHERE T1.SUB_INDUSTRY = `NAME` AND TYPE = 'SUB_INDUSTRY_TYPE' AND ACT_FLG = 'Y' AND LANG_ID = #{entity.langId} ) AS subIndustry,
        T4.COUNTRY as country,
        T4.STATE as state,
        T4.CITY as city,
        T4.COUNTY as county,
        T4.ADDR1 as addr1,
        T4.ADDR2 as addr2
        FROM
        (HC_ACCNT T1 LEFT JOIN
        (
        SELECT
        T1.CODE,
        T3.COUNTRY,
        T3.STATE,
        T3.CITY,
        T3.COUNTY,
        T3.ADDR1,
        T3.ADDR2
        FROM
        HC_ACCNT T1,
        HC_ACCNT_ADDR T2,
        HC_ADDR T3
        WHERE
        T1.`CODE` = T2.ACCNT_CODE
        AND T2.ADDR_CODE = T3.CODE
        AND T2.PRI_FLG = 'Y'
        AND T2.STATUS = 'Active'
        ) T4 ON T1.CODE = T4.CODE)
        WHERE
        1=1
        <include refid="queryALLConditionSql"></include>
        limit #{start},#{pageSize}
    </select>

    <select id="queryAccountCount" parameterType="com.hand.frame.util.PageQuery" resultType="int">
        SELECT COUNT(*)
        FROM
        HC_ACCNT

        WHERE
        1=1
        <include refid="queryALLConditionSql"></include>
    </select>

    <update id="updateAccount" parameterType="com.hand.account.access.vo.AccountVO">
        UPDATE HC_ACCNT SET UPDATED=sysdate(),
        <include refid="updateConditionSql"></include>
        WHERE CODE=#{code}
    </update>
</mapper>